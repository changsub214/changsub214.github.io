---
title: "Network Security 9장"
categories:
  - ns
tags:
  - study
  - networksecurity
toc: true
toc_sticky: true
use_math: true
---

> 본 글은 학교에서 '네트워크 보안'을 수강하면서 내용을 정리한 글입니다.

## IP 보안

+ 인증
    - 수신 패킷이 정말로 패킷 헤더 안에 들어있는 발신지로부터 온 것인지 확인
+ 기밀성
    - 제 3자 도청을 방지하기 위해 통신 노드 간 메시지를 암호화
+ 키 관리
    - 안전한 키 교환

### IP 보안 개요

+ IAB(Internet Architecture Board)
    - 차세대 IPv6 필수보안장치
        + 인증, 암호 
    - IPv4와 호환성 유지
+ 인터넷 구조 보안(Security in the Internet Architecture)보고서
    - 불법 모니터링으로부터의 보호
    - 네트워크 트래픽 제어
    - 종단 대 종단 트래픽 안전
        + 인증 및 암호 메커니즘
+ IPsec 응용
    - IPsec의 보호 대상
        + LAN
        + 사설 및 공공 WAN
        + 인터넷을 통과하는 통신
+ IPsec 기능
    - 인터넷을 통한 안전한 지사 사무실 연결
        + 인터넷이나 공공 WAN을 이용한 안전한 가상 사설망 구축
        + 비용절감과 네트워크 관리 부담 축소
    - 인터넷을 통한 안전한 원격 접근
        + IP 보안 프로토콜이 장착된 시스템 종단 사용자는 ISP를 통한 용이한 네트워크 접근 가능
        + 재택근무, 출장자 통신비용 절감
    - 협력업체와의 인트라넷과 엑스트라넷 구축
        + 인증과 기밀성 보장
        + 키교환 메커니즘을 통한 다른 기관과 안전 통신 보장
    - 전자상거래 보안 강화
        + IPsec을 통한 보안성 강화
+ IPsec 보안 영역
    - IP 계층에서 모든 트래픽에 대한 암호화와 인증
    - IPsec 보호 영역
        + 원격 로그인
        + 클라이언트/서버
        + 전자메일
        + 파일전송
        + 웹 접근
        + 분산 응용
+ IPsec 장점
    - IPsec을 침입차단시스템이나 라우터에서 구현
        + 영역 내 모든 트래픽에 적용할 수 있는 강한 보안성을 제공
    - 침입차단시스템에서의 IPsec은 우회하는 트래픽 차단
        + 외부에서 오는 모든 트래픽이 IP을 사용
        + 인터넷으로부터 내부로 유입되는 유일한 경로는 침입차단시스템
    - IPsec은 전송계층 아래에 존재하여 응용 프로그램에게 투명
        + 사용자/서버 시스템이 소프트웨어 변경 불필요
        + 상위 계층 소프트웨어에 영향 없음
    - 종단 사용자에게 투명
        + 보안 메커니즘에 대한 사용자 교육 불필요
        + 개별 키 발급 불필요
        + 키 취소 불필요
    - 개별 사용자에게 IPsec 제공
        + 외지 근무자에게 유용
        + 기관 내 안전 가상 서브네트워크 구성 가능
+ IPsec의 IP계층에서 서비스 제공 방법
    - 요구된 보안 프로토콜 선택하게 함
    - 서비스에 필요한 알고리즘을 결정
    - 요구된 서비스에 필요한 암호 키를 설정하게 함
    - 보안에 사용되는 프로토콜
        + 인증 프로토콜 
            - AH(Authentication Header)
        + 암호화와 인증이 결합된 프로토콜
            - ESP(Encapsulating Security Payload)
+ IPsec Service(RFC4301)
    - 접근 제어
    - 비연결 무결성
    - 데이터 발신처 인증
    - 재전송 패킷의 거부
    - 기밀성
    - 제한된 트래픽 플로우 기밀성
+ 전송 모드 & 터널 모드
    - AH와 ESP는 전송과 터널 모드 지원
    - 전송모드?
        + 주로 상위계층 프로토콜 보호
        + IP 패킷의 페이로드 범위까지 보호
            - TCP 세그먼트
            - UDP 세그먼트
            - ICMP 패킷
        + 호스트 프로토콜 계층의 IP위에서 직접 동작
        + 두 호스트 사이의 종단-대-종단 통신에 전송 모드를 이용
        + IPv4
            - AH or ESP를 사용하면 페이로드는 보통 IP헤더 뒤에 붙는 데이터로 간주
        + IPv6
            - 페이로드는 통상적으로 IP헤더와 존재하는 모든 IPv6 확장 헤더 뒤에 붙는 데이터로 간주
        + 여기서 ESP 동작은?
            - IP 페이로드를 암호화하고 인증은 선택사항
            - IP 헤더는 암호화를 하지 않음
        + 여기서 AH 동작은?
            - IP 페이로드와 IP 헤더의 선별된 일부만 인증 
    - 터널모드?
        + IP패킷 전체 보호
            - AH or ESP field를 IP packet에 추가
        + 전체 패킷과 보안 필드
            - 새 외부 IP헤더 부착
            - 외부 IP 패킷의 페이로드로 간주
        + 원래의 전체 패킷 혹은 내부 패킷은 터널로 이동
            - 경로상 어떤 라우터도 내부 IP헤더 검사 불가
+ 라우팅 응용
    - 라우터 광고 메시지가 인증된 라우터로부터 전송된 사실을 인증
    - 이웃 라우터의 광고 메시지가 인증된 라우터로부터 전송됨을 보장
    - 재 지정된 메시지가 초기 패킷을 받은 라우터로부터 전송된 사실 보장
    - 라우터 갱신 정보가 위조되지 않았다는 사실 보장

### IP 보안 정책

+ 2개의 데이터베이스 상호 적용으로 결정
    - 보안 연관 데이터베이스(SAD : Security Association Database)
    - 보안 정책 데이터베이스(SPD : Security Policy Database)
        + IP 트래픽을 특정 SA에 연관시키는 방법(단 IPsec을 우회하는 것이 허용된 트래픽의 경우에는 SA가 없음)인 명목상 DB
        + 간단한 형식 SPD
            - 여러 엔트리를 포함하고 있는데 각 엔트리는 IP 트래픽의 서브셋을 정의하고 그 트래픽을 위한 특정 연관(SA)을 가리킴
        + 복잡한 환경의 SPD
            - 단일 SA에 관련된 다중 엔트리 또는 단일 SPD 엔트리와 연관된 다중 SA가 존재   
+ IPsec 구조
    <img src="/assets/image/ns-image/ns-084.png" width="100%" height="100%">
+ 보안 연관(SA : Security Association)
    - 연관이란 그 위에 실어 보내는 트래픽에 보안서비스를 제공하는 송신자와 수신자 사이의 일방향 관계
    - 양방향 보안 교신을 위한 대등(peer)관계가 필요하면 두 개의 보안 연관을 사용
    - AH or ESP를 사용(동시 사용 불가)위해 SA에 보안서비스 제공
+ 보안 연관 식별 매개 변수
    - 보안 매개변수 색인(SPI : Security Parameters Index)
    - IP 목적지 주소(IP Destination Address)
    - 보안 프로토콜 식별자(Security Protocol Identifier)
        + IPv4 or IPv6 헤더 안의 목적지 주소와 그 안에 포함된 확장헤더(AH or ESP)속의 SPI를 가지고 유일하게 식별

### 캡슐화 보안 페이로드

+ ESP가 제공하는 것
    - 기밀성
    - 데이터 출처 인증
    - 비연결형 무결성
    - 재전송 방지 서비스(부분적 순서 무결성의 형태)
    - (제한된)트래픽 흐름의 비밀성
+ GCM 같은 인증 암호화 알고리즘을 포함하여 다양한 암호화와 인증 알고리즘으로 동작

### 보안 연관 묶기





### 인터넷 키 교환

+ IPsec의 키 관리
    - 비밀키 결정
    - 비밀키 분배
+ 통신에는 일반적으로 4개의 키가 필요
    - 무결성에 한쌍
    - 기밀성에 한쌍
+ IPsec구조에서 지원하는 키 관리
    - 자동관리 
    - 수동관리
+ ISAKMP/Oakley
    - Ipsec의 디폴트 자동화 키 관리 프로토콜
    - 구성요소
        + Oakley 키 결정 프로토콜(Oakley Key Determination Protocol)
            - Oakley 키교환 프로토콜은 Diffie-Hellman 알고리즘 기반으로 추가 보안을 제공하는 프로토콜
            - Oakley는 특정 형식을 강요하지 않고 포괄적임
        + 인터넷 보안 연관과 키 관리 프로토콜(ISAKMP: Internet Security Association and Key Management Protocol)
            - ISAKMP는 인터넷 키 관리에 대한 구조를 지원
            - 보안속성 협상을 위한 특정 프로토콜 지원 제공
    - ISAKMP
        + 특정 키교환 알고리즘을 강요하지 않음
        + 다양한 키 교환 알고리즘 사용가능하도록 메시지 유형의 집합으로 구성
    - Oakley    
        + 초기 버전의 ISAKMP를 강제적으로 사용하도록 한 키교환 알고리즘
    - IKEv2에서 Oakley와 ISAKMP라는 용어는 더 이상 사용하지 않지만 기능